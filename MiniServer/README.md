## MiniServer

This directory contains a .net c# project that's a server to mini chat application. The server is responsible for managing application users and data.
Architecture is server dispatcher-ish.

### Project Structure
- **Core** - Contains the core logic of the application.
  - **Events:**
  -  - Dispatcher serves for load balancing and event handling.
  -  - Events are based on EventBas class and described for sakes of simplicity in CommEvents.cs
  -  - Factory handles dependency injection and creation of event handlers.
  - **Connection manager** - manages current open stream connections
- **Data** - Contains the database context(entity relations),model, repositories and helper data objects.
  - **Migrations** - Contains the database migrations generated by.
- **Protos** - Contains the proto files for the grpc chat service.
- **Services** - Contains the grpc service aka "controller service" and the business logic services implementation.
- **Utils** - Contains the utility classes and methods, currently containing JWT auth token helper.
- **Program.cs** - The entry point of the application. Also for some unholy reason serves as config file for "bean" definition.


### Deployment and Cloud
The server could be deployd via docker compose & dockerfile

Following cloud options were considered for deployment:
- **Heroku** - as a task suggested but, RIP free dynos since nov 28th 2022
- **AWS** - free tier suggests only 1gb ram, 20gb storage and single core, which may be insufficient for the project, atleast it negates dispatcher part
- **Oracle** - registration is too obscure and buggy
- **Google Cloud** - unfortunately google recognized that my account already used free three months trial

### How to startup
1. Install docker-compose or docker desktop ui and run ```docker-compose up db``` to startup database
2. Prepare database using ```dotnet ef update``` command
3. Start the Program.cs file in root of the project


### OUATH2 Scenarios:
#### Registering a New User
1. Send a registration request to the server.
2. The server may create a new user and return an authentication token and a refresh token.
3. The client should store the token and refresh token in a secure place.
4. The client should use the refresh token approximately every hour to refresh the authentication token.


#### Authorizing an Existing User
An existing user can authorize in the following ways:
1. **Using a Token**:
    - If the token is not expired, it can be used to access the service.
2. **Using a Refresh Token**:
    - Use the refresh token to acquire a new authentication token.
3. **Using Username and Password**:
    - Use the username and password to acquire a new authentication token and refresh token.


#### DATABASE:
To work with database out of c# db contexts use dotnet ef command line tool.